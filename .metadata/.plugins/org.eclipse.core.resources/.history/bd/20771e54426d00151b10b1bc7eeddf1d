<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Step Time Trend Analysis</title>
<script src="js/echarts.js"></script>
<!-- <script src="js/jquery-2.1.4.min.js"></script>-->
<!-- <script src="js/jquery.csv-0.71.js"></script>  -->
<script type="text/javascript">
var dataSet;
var chartStepTime;
option = {
	    title : {
	        text: 'Step Time Trend',
	        subtext: 'TX_KR22'
	    },

	    tooltip : {
	        trigger: 'axis',
	        showDelay : 0,
	        formatter : function (params) {
	        	var dt = new Date(params.value[0]);
	        		//console.log (params.seriesName);
	            	//console.log (dt.getMonth() + '/' + dt.getDate() + ' ' + dt.getHours() + ':' + dt.getMinutes() );
/*
	            	var dt = new Date(params.value[0]);
	            	
	                return params.seriesName + ' :<br/>'
	                	+ data (date.getMonth() + 1) + '-'
		                   + date.getDate() + ' '
		                   + date.getHours() + ':'
		                   + date.getMinutes() + ' :<br/>'
		                   + 'Step time: ' + 
	                   + params.value[1] + 'min'; 
		                   */
		           //return params.value[1] + ' min';
		                   return 'Date: ' + dt.getMonth() + '/' + dt.getDate() + ' ' + dt.getHours() + ':' 
		                   	+ dt.getMinutes() + ' <br/>'
		                   	+ params.seriesName + ': ' 
		                   	+ params.value[1] + ' min';
	        }  
	        /*
	        axisPointer:{
	            show: true,
	            type : 'cross',
	            lineStyle: {
	                type : 'dashed',
	                width : 1
	            }
	        }
	        */
	    },
	    
	    dataZoom : {
	        show : true,
	        start : 0,
	        end : 100
	    },
	    
	    legend: {
	        data:['Step time','Target']
	    },
	    toolbox: {
	        show : true,
	        feature : {
	            mark : {show: true},
	            dataZoom : {show: true},
	            dataView : {show: true, readOnly: false},
	            restore : {show: true},
	            saveAsImage : {show: true}
	        }
	    },

	    xAxis : [
	        {
	            type : 'value',
	            scale:true,
	            axisLabel : {
	                formatter: function(value){
	                	var dt = new Date(value);
	                	return dt.getMonth() + '/' + dt.getDate();
	                }
	            }
	        }
	    ],
	    yAxis : [
	        {
	            type : 'value',
	            scale:true,
	            axisLabel : {
	                formatter: '{value} min.'
	            }
	        }
	    ],
	    series : [
	        {
	            name:'Step time',
	            type:'scatter',
	            data: []

	        },
	        {
	            name:'Target',
	            type:'scatter',
	            data: []
	        }
	    ]
	};
	                    
	require.config({
        paths: {
            echarts: 'js'
        }
    });
	require(
            [
                'echarts',
                'echarts/chart/scatter' // require the specific chart type
            ],
            function (ec) {
            	chartStepTime = ec.init(document.getElementById('scatterTrendChart'));
            	chartStepTime.setOption(option);
            }
    );
	
</script>
</head>
<body>
	<h2>Step time analysis</h2>
	<div id="scatterTrendChart" style="height:400px, width:800px"></div>
	
	<!-- <a id="sourceFile" href="c:/Apache24/htdocs/eChartTest/StepTimeStat.csv">Source data</a> -->
	<!-- <a id="sourceFile" href="http://usfrpvmesepitc2.dow.com/lab/StepTimeTrend.csv">Source data</a> -->
	<!-- <a id="sourceFile" href="http://localhost/eChartTest/Tx_KR22_24240_WaitTransfer.csv">Source data</a> -->
	<a id="sourceFile" href="http://localhost/eChartTest/Tx_KR22_24240_1OxFeed.csv">Source data</a>
	<p>
		<a id="fileContent">File content (to be loaded)</a>
	</p>
	<script type="text/javascript">
		//this part of the code handles graphics output
		function loadGraph()
		{
			// configure for module loader
			var dsStepTime = [];
			var dsTarget = [];
			for (var i=1; i<dataSet.length; i++){
				dsStepTime.push([
				                 Date.parse(dataSet[i][11]),
				                 parseInt(dataSet[i][7])
				                 ]
						);
				dsTarget.push([
								Date.parse(dataSet[i][11]),
								parseInt(dataSet[i][8])
				               ]
						);
				
			}
			//option.title.subtext = 'Product:' + dataSet[1][4] + '  Step name: ' + dataSet[1][6];
			//console.log(dataSet[1][4]);
			var tp = dataSet[1][4] + ' Step time vs Target trend';
			option.title.text = tp;
			var tp1 =  dataSet[1][6] + ''; 
			option.title.subtext = 'Step name: ' + tp1;
			option.series[0].data = dsStepTime;
			option.series[1].data = dsTarget;
			chartStepTime.setOption(option);
	    }		
		
	</script>
	<script type="text/javascript">
		//this section loads the csv file from the server
		var file;
		var allText;
		file = document.getElementById("sourceFile").href;
		//alert(file);
		var txtFile = new XMLHttpRequest();
	    txtFile.open("GET", file, true);
	    txtFile.onreadystatechange = function(){
	    	dataSet= [];
	        if(txtFile.readyState === 4)
	        {
	            if(txtFile.status === 200 || txtFile.status == 0)
	            {
	            	var content = txtFile.responseText;
	    	    	var allLines = content.split(/\r\n|\n/);
	    	    	while (allLines.length){
	    	    		dataSet.push(allLines.shift().split(','));
	    	    	}
	    	    	document.getElementById("fileContent").innerHTML = 'Data loaded: ' + dataSet[0];
	    	    	loadGraph();
	    	  	}
	            else if (tstFile.status === 404){
	            	document.getElementById("fileContent").innerHTML = 'Error, the csv data file is not found!'
	            }
	        }
	    }
		txtFile.send();
		//var data = $.csv.toObjects(file);
	</script>
</body>
</html>